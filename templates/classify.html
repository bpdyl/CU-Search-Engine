{% extends "base.html" %}

{% block title %}Document Classification - Coventry Research Search{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <!-- Page Header -->
    <div class="page-header" style="text-align: center;">
        <h1 class="page-title"><i class="bi bi-tags" style="color: var(--primary-color);"></i> Document Classification</h1>
        <p class="page-description">
            Classify documents into Business, Entertainment, or Health categories using Naive Bayes
        </p>
    </div>

    <!-- Classification Form -->
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">
                <i class="bi bi-file-text"></i> Enter Text to Classify
            </h3>
        </div>
        <div class="card-body">
            <form action="{{ url_for('classify') }}" method="POST">
                <div class="mb-3">
                    <textarea class="form-control" name="text" rows="6"
                              placeholder="Paste or type your document text here..."
                              style="min-height: 150px;">{{ text if text else '' }}</textarea>
                </div>
                <div class="d-flex justify-content-between align-items-center" style="flex-wrap: wrap; gap: 0.5rem;">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-cpu"></i> Classify Document
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="loadSampleText()">
                        <i class="bi bi-lightning"></i> Load Sample
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Classification Result -->
    {% if result %}
    <div class="card mb-4 fade-in">
        <div class="card-header">
            <h3 class="card-title">
                <i class="bi bi-graph-up"></i> Classification Result
            </h3>
        </div>
        <div class="card-body">
            {% if result.error %}
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i> {{ result.error }}
                </div>
            {% else %}
                <!-- Predicted Category -->
                <div class="classification-result mb-4">
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem;">Predicted Category</div>
                    <div class="classification-category">
                        {% if result.category == 'Business' %}
                            <i class="bi bi-briefcase"></i> Business
                        {% elif result.category == 'Entertainment' %}
                            <i class="bi bi-film"></i> Entertainment
                        {% elif result.category == 'Health' %}
                            <i class="bi bi-heart-pulse"></i> Health
                        {% else %}
                            {{ result.category }}
                        {% endif %}
                    </div>
                    <div class="classification-confidence">
                        Confidence: <strong>{{ (result.confidence * 100)|round(1) }}%</strong>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: {{ result.confidence * 100 }}%;"></div>
                    </div>
                </div>

                <!-- Probability Distribution -->
                <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Probability Distribution</h4>
                {% for category, prob in result.probabilities.items() %}
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center" style="margin-bottom: 0.375rem;">
                        <span style="display: flex; align-items: center; gap: 0.5rem;">
                            {% if category == 'Business' %}
                                <span class="stat-icon primary" style="width: 28px; height: 28px; font-size: 0.8rem;"><i class="bi bi-briefcase"></i></span>
                            {% elif category == 'Entertainment' %}
                                <span class="stat-icon success" style="width: 28px; height: 28px; font-size: 0.8rem;"><i class="bi bi-film"></i></span>
                            {% elif category == 'Health' %}
                                <span class="stat-icon danger" style="width: 28px; height: 28px; font-size: 0.8rem;"><i class="bi bi-heart-pulse"></i></span>
                            {% endif %}
                            {{ category }}
                        </span>
                        <span style="font-weight: 600;">{{ (prob * 100)|round(1) }}%</span>
                    </div>
                    <div style="background: var(--bg-primary); border-radius: 9999px; height: 8px; overflow: hidden;">
                        <div style="height: 100%; border-radius: 9999px; transition: width 0.5s ease;
                            {% if category == 'Business' %}background: var(--primary-color);
                            {% elif category == 'Entertainment' %}background: var(--success-color);
                            {% elif category == 'Health' %}background: var(--danger-color);
                            {% endif %}
                            width: {{ prob * 100 }}%;"></div>
                    </div>
                </div>
                {% endfor %}

                <!-- Text Preview -->
                {% if result.text_preview %}
                <div class="mt-4">
                    <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">Analyzed Text</h4>
                    <div style="background: var(--bg-primary); padding: 1rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                        <small style="color: var(--text-secondary);">{{ result.text_preview }}</small>
                    </div>
                </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Model Information -->
    {% if model_info %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="bi bi-info-circle"></i> Model Information
            </h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-12 col-md-6" style="margin-bottom: 1rem;">
                    <div style="margin-bottom: 0.5rem;">
                        <span style="color: var(--text-muted); font-size: 0.85rem;">Status:</span>
                        {% if model_info.status == 'Model loaded' %}
                            <span class="badge badge-success">Ready</span>
                        {% else %}
                            <span class="badge badge-warning">Not Loaded</span>
                        {% endif %}
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <span style="color: var(--text-muted); font-size: 0.85rem;">Algorithm:</span>
                        <span>Multinomial Naive Bayes</span>
                    </div>
                    <div>
                        <span style="color: var(--text-muted); font-size: 0.85rem;">Categories:</span>
                        {% for cat in model_info.categories %}
                            <span class="badge badge-secondary">{{ cat }}</span>
                        {% endfor %}
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <div style="margin-bottom: 0.5rem;">
                        <span style="color: var(--text-muted); font-size: 0.85rem;">Training Accuracy:</span>
                        <span style="font-weight: 600;">
                            {% if model_info.accuracy is defined and model_info.accuracy != 'N/A' %}
                                {{ (model_info.accuracy * 100)|round(1) }}%
                            {% else %}
                                N/A
                            {% endif %}
                        </span>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <span style="color: var(--text-muted); font-size: 0.85rem;">Training Samples:</span>
                        <span>{{ model_info.total_samples if model_info.total_samples is defined else 'N/A' }}</span>
                    </div>
                    <div>
                        <span style="color: var(--text-muted); font-size: 0.85rem;">Trained:</span>
                        <span>
                            {% if model_info.trained_at is defined and model_info.trained_at != 'N/A' %}
                                {{ model_info.trained_at[:10] }}
                            {% else %}
                                N/A
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function loadSampleText() {
    const samples = [
        "The Federal Reserve announced a quarter-point interest rate increase today, citing concerns about inflation. Stock markets reacted positively with the Dow Jones Industrial Average gaining 200 points. Economists predict this will impact mortgage rates and consumer lending in the coming months.",
        "The new blockbuster superhero movie shattered box office records this weekend, earning over $300 million globally. Critics praised the stunning visual effects and compelling storyline. The film's director announced plans for a sequel to be released next summer.",
        "Researchers at the medical center published groundbreaking findings on a new cancer treatment. Clinical trials showed a 60% improvement in patient outcomes compared to traditional therapies. The FDA is expected to review the treatment for approval early next year."
    ];
    document.querySelector('textarea[name="text"]').value = samples[Math.floor(Math.random() * samples.length)];
}
</script>
{% endblock %}

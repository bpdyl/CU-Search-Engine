{% extends "base.html" %}

{% block title %}Search Results - Coventry Research Search{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto;">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title"><i class="bi bi-search"></i> Search Publications</h1>
        <p class="page-description">Find research publications from the department</p>
    </div>

    <!-- Search Form -->
    <div class="card mb-4">
        <div class="card-body" style="padding: 1rem;">
            <form action="{{ url_for('search') }}" method="GET" style="display: flex; gap: 0.5rem;">
                <input type="text" class="form-control" name="q"
                       value="{{ query }}" placeholder="Search publications, authors, keywords..."
                       style="flex: 1;">
                <button class="btn btn-primary" type="submit">
                    <i class="bi bi-search"></i> Search
                </button>
            </form>
        </div>
    </div>

    <!-- Results Section -->
    {% if query %}
        {% if results %}
            <div class="d-flex justify-content-between align-items-center mb-3">
                <span style="color: var(--text-secondary); font-size: 0.9rem;">
                    Found <strong>{{ results|length }}</strong> results for "<strong>{{ query }}</strong>"
                </span>
                <span class="badge badge-secondary">Sorted by Relevance</span>
            </div>

            <!-- Results List -->
            <div class="results-list">
                {% for result in results %}
                <div class="search-result fade-in">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem;">
                        <div style="flex: 1;">
                            <!-- Title -->
                            <h3 class="search-result-title">
                                {% if result.publication_link %}
                                    <a href="{{ result.publication_link }}" target="_blank">
                                        {{ result.title }}
                                        <i class="bi bi-box-arrow-up-right" style="font-size: 0.8rem;"></i>
                                    </a>
                                {% else %}
                                    {{ result.title }}
                                {% endif %}
                            </h3>

                            <!-- Meta Info -->
                            <div class="search-result-meta">
                                <span>
                                    <i class="bi bi-calendar"></i>
                                    {{ result.year }}
                                </span>
                                <span>
                                    <i class="bi bi-people"></i>
                                    {% for author in result.authors %}
                                        {% if result.author_profiles and author in result.author_profiles %}
                                            <a href="{{ result.author_profiles[author] }}" target="_blank" style="color: var(--success-color);">{{ author }}</a>{% if not loop.last %}, {% endif %}
                                        {% else %}
                                            {{ author }}{% if not loop.last %}, {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </span>
                            </div>

                            <!-- Abstract -->
                            {% if result.abstract %}
                            <p class="search-result-abstract">
                                {{ result.abstract[:300] }}{% if result.abstract|length > 300 %}...{% endif %}
                            </p>
                            {% endif %}

                            <!-- Keywords -->
                            {% if result.keywords %}
                            <div class="search-result-keywords">
                                {% for kw in result.keywords[:5] %}
                                    <span class="keyword-tag">{{ kw }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Score Badge -->
                        <div style="text-align: right;">
                            <span class="badge badge-primary" title="Relevance Score" style="font-size: 0.85rem;">
                                {{ "%.2f"|format(result.score) }}
                            </span>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        {% if result.publication_link %}
                            <a href="{{ result.publication_link }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-file-text"></i> View Publication
                            </a>
                        {% endif %}
                        {% if result.author_profiles %}
                            {% for author, url in result.author_profiles.items() %}
                                <a href="{{ url }}" target="_blank" class="btn btn-sm btn-outline-secondary">
                                    <i class="bi bi-person"></i> {{ author.split()[-1] }}
                                </a>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

        {% else %}
            <!-- No Results -->
            <div class="card" style="text-align: center; padding: 3rem;">
                <div style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1rem;">
                    <i class="bi bi-search"></i>
                </div>
                <h3 style="margin-bottom: 0.5rem;">No results found</h3>
                <p style="color: var(--text-secondary);">
                    No publications match your search for "<strong>{{ query }}</strong>".
                </p>
                <p style="color: var(--text-muted); font-size: 0.9rem;">
                    Try different keywords or check your spelling.
                </p>
            </div>
        {% endif %}
    {% else %}
        <!-- No Query -->
        <div class="card" style="text-align: center; padding: 3rem;">
            <div style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1rem;">
                <i class="bi bi-journals"></i>
            </div>
            <h3 style="margin-bottom: 0.5rem;">Start Searching</h3>
            <p style="color: var(--text-secondary);">
                Enter a search query to find publications.
            </p>
            <div style="margin-top: 1rem; color: var(--text-muted); font-size: 0.9rem;">
                Try searching for:
                <a href="{{ url_for('search', q='deep learning') }}">deep learning</a>,
                <a href="{{ url_for('search', q='healthcare') }}">healthcare</a>,
                <a href="{{ url_for('search', q='optimization') }}">optimization</a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
